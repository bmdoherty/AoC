// change w (width of cells) to zoom into top left
var w = 3.65; //3.65

const processInput = str => {
    return str.split(/\n/).map(v => v.split(""));
};

const getStart = grid => {
    let height = grid.length;
    let width = grid[0].length;

    for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
            if (grid[x][y] === "|") {
                return [x, y];
            }
        }
    }
};
var path = [];
const findPath = (grid, node, direction) => {
    let seen = {};

    const turn = (grid, x, y, direction) => {
        if (["left", "right"].includes(direction)) {
            if (grid[y - 1][x] != " ") {
                return "up";
            } else {
                return "down";
            }
        } else {
            if (grid[y][x - 1] != " ") {
                return "left";
            } else {
                return "right";
            }
        }
    };

    const move = node => {
        const TURN = "+";
        const END = " ";
        let x = node[1];
        let y = node[0];
        let chr = grid[y][x];
        let i = 0;
        let steps = [];

        while (chr !== END) {
            if (isLetter(chr)) {
                path.push(chr);
            }

            if (chr === TURN) {
                direction = turn(grid, x, y, direction);
            }

            switch (direction) {
                case "up":
                    y = y - 1;
                    break;
                case "down":
                    y = y + 1;
                    break;
                case "left":
                    x = x - 1;
                    break;
                case "right":
                    x = x + 1;
                    break;
                default:
                    break;
            }

            steps.push({ cord: [x, y], chr: chr });

            i++;
            chr = grid[y][x];
        }
        return { letters: path.join(""), steps: steps };
    };

    return move(node, direction);
};

const isLetter = chr => {
    if (chr !== "+" && chr !== "|" && chr !== "-" && chr !== " ") {
        return true;
    }
    return false;
};
const f = str => {
    let grid = processInput(str);
    let start = getStart(grid);

    let { letters, steps } = findPath(grid, start, "down");

    return findPath(grid, start, "down");
};
//////////////////////////
function paint(ctx, cell, color, ms) {
    fillCell(ctx, cell[0], cell[1], color);
    return new Promise(resolve => setTimeout(resolve, ms));
}

function getRandomColor() {
    let red = Math.floor(Math.random() * 256);
    let green = Math.floor(Math.random() * 256);
    let blue = Math.floor(Math.random() * 256);
    let color = `rgb(${red},${green},${blue})`;

    return `rgb(${red},${green},${blue})`;
}

function fillCell(ctx, x, y, color) {
    //let w = 6;
    ctx.fillStyle = color;
    ctx.fillRect(x * w, y * w, w, w);
}

async function demo(ctx, str) {
    let { letters, steps } = f(str);
    let color = getRandomColor();
    for (let step of steps) {
        await paint(ctx, step["cord"], color, ms);
        if (isLetter(step["chr"])) {
            document.getElementById("log").innerHTML += step["chr"];
        }
    }
}

var ctx = document.getElementById("canvas").getContext("2d");
var ms = 0;

function setup(ctx, grid) {
    let i = 0;
    let j = 0;
    offsets = {
        "+": [0.12, 0.9, 1.5],
        "|": [0.4, 1, 1.5],
        "-": [0.1, 1.15, 2.75],
        X: [0.15, 0.8, 1],
        " ": [0.25, 0.7, 0.9]
    };
    let color = getRandomColor();
    for (let x = 0; x < grid[0].length; x++) {
        for (let y = 0; y < grid.length; y++) {
            let content = grid[y][x];
            let offset;
            if (isLetter(content)) {
                offset = offsets["X"];
            } else {
                offset = offsets[content];
            }

            ctx.fillStyle = color;
            ctx.fillRect(x * w, y * w, w, w);
            ctx.fillStyle = "white";
            let offsetX = w * offset[0];
            let offsetY = w * offset[1];
            let fontSize = w * offset[2];
            ctx.font = fontSize + "px serif";

            ctx.fillText(content, x * w + offsetX, y * w + offsetY);
        }
    }
}

var str = `                                                                                                                                       |                                                                 
     +---------------+       +-------+ +-----------------------------------------------------------------------------------------+     |                                               +-----+ +-+       
     |               |       |       | |                                                                                         |     |                                               |     | | |       
     | +-+ +-----------------|-------+ |           +-+         +-----------+ +---------------------------------------------------------|-----------------------------------------------------+ | |       
     | | | |         |       |         |           | |         |           | |                                                   |     |                                               |       | |       
   +-+ +---------------------|---------------------------------------------|-+         +---------------------------+             |     |       +-------+                   +-+     +-----------|-+       
   |     | |         |       |         |           | |         |           |           |                           |             |     |       |       |                   | |     |   |       |         
   |   +---|---+   +-|-------|---------|-----------|-----------+           |           |                           |     +-------|-------------|-------|-------------------|-|-------+ |       |         
   |   | | |   |   | |       |         |           | |                     |           |                           |     |       |     |       |       |                   | |     | | |       |         
 +-----|---|---|---|-|-------|---------+           +-----+                 |       +-------+ +---------------------------|-------|-------------|-----------------------------------+ | |       |         
 | |   | | |   |   | |       |                       |   |                 |       |   |   | |                     |     |       |     |       |       |                   | |       | |       |         
 | |   | | |   | +-|-------+ |         +-----------------|-------------+   |       +---|-----|---------------------|-------------|---------------------|---------------+   | |       | |       |         
 | |   | | |   | | | |     | |         |             |   |             |   |           |   | |                     |     |       |     |       |       |               |   | |       | |       |         
 +---+ | | |   +-----|-------|---------------------------------------------------------|---|-----------+     +-------------------|---+ |       |       |               |   | |       | |       |         
   | | | | |     | | |     | |         |             |   |             |   |           |   | |         |     |     |     |       |   | |       |       |               |   | |       | |       |         
   | | | +-|-+   +-------+ +-+         |             |   |             |   |           |   | |         |     |     |     |   +---|---+ |       |       |               |   | |       | |       |         
   | | |   | |     | |   |             |             |   |             |   |           |   | |         |     |     |     |   |   |     |       |       |               |   | |       | |       |         
   +---|-+ | |   +---|---|---------------------------|---|-----------------|---------------------------|-----|-----|---------|---|-----|---------------|-------------+ |   +-|-----+ | | +-----|---+     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |     |     |     |   |   |     |       |       |             | |     |     | | | |     |   |     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |     +-----|----I|---|---|-----------------+   +-------------|-----+ | +-+ | | | |     |   |     
     | | | | |   | | |   |             |             |   |             |   |           |   | |         |           |     |   |   |     |       |   |                 | |   | | | | | | | |     |   |     
     | | | | |   | | +---|------------------------B--|---|-------------|---------------|-----|---------|-----------|-------------------|-------|---|-----------------|-----|-----|-----|---------+ |     
     | | | | |   | |     |             |             |   |             |   |           |   | |         |           |     |   |   |     |       |   |                 | |   | | | | | | | |     | | |     
 +-+ | | | | |   | |     |             |       +-----|---|-------------|---------------|---|-|---------------------|---------+   |   +---------|---|-----+           | |   | | | | | | | |     | | |     
 | | | | | | |   | |     |             |       |     |   |             |   |           |   | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | | |     
 | | | | | | |   | |     |   +-+       |       | +-------|-----------------|-------------+ | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | | +-+   
 | | | | | | |   | |     |   | |       |       | |   |   |             |   |           | | | |         |           |     |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | | +---|-------|---|-|-------|---------|---|---|---------------------------------|-|---------------------|---+ |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | |     | |     |   | |       |       | |   |   |             |   |           | | | |         |           |   | |       |   | |       |   |     |           | |   | | | | | | | |     | |   |   
 | | | | | |     | |     |   | |       |   +---+ |   |   |             |   |       +---|-|-|-|---------|-----------|---|-------------|-|-------|---|-----------------|-------------------------|---+ |   
 | | | | | |     | |     |   | |       |   |     |   |   |             |   |       |   | | | |         |           |   | |       |   | |       |   |     |           | |   | | | | | | | |     | | | |   
 | | | | +-|-----------+ |   | |       |   +-----|---|---|-----------------|-----------|---|-----------------------|---|---------|-+ | |       |   |     |           | |   | +---|-|-|---|-+   | | | |   
 | | | |   |     | |   | |   | |       |         |   |   |             |   |       |   | | | |         |           |   | |       | | | |       |   |     |           | |   |   | | | | | | |   | | | |   
 | | | |   |     | |   | |   | |       |         |   |   +-------------------------|---|---------------|-----------+   | |       | | | |       |   |     |         +-|-|-------|-+ | | | | |   | | | |   
 | | | |   |     | |   | |   | |       |         |   |                 |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     | +-----|---|-------------------|---------+           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   |   |   | | | | |   | | | |   
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   | +-------|-----|---|-|-----+ 
 | | | |   |     |     | |   | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |         | | |   | | |   | | | | |   | | | | | 
 | | | |   |     |     | +-------------|-------------|-----------------|---|-------|-------------------|---------------|---------------------------|-----------+   | | |   | +-+ +-|---|---|-----|---|-+ 
 | | | |   |     |     |     | |       |         |   |     |           |   |       |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 | | | |   |   +-----------------------------+   |   |     |   +---------------+   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 | | | |   |   | |     |     | |       |     |   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | | | | | |   | | | |   
 +-|---|-------|-|-+   +-+   | +-------------|---|---|-----|---|-----------|-------|-------|-|-----------------------------------|---|-|-------|---|-----|---------|-|-|---|-----|---+ | | | +-|---|---+ 
   | | |   |   | | |     |   |         |     |   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | |   |     | |   | | | | | | | | | 
 +-|---|-------------+   | +-|---------+   +-+   |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | | +---+ +-------|-|-|---|-|---|-+ 
 | | | |   |   | | | |   | | |             |     |   |     |   |       |   |   |   |   | | | |         |               | |       | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
 +---------|---|---|-|-----+ |             |     |   |     |   |       |   |   |   |   | | | |         | +---------------------+ | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
   | | |   |   | | | |   |   |             |     |   |     |   |       |   |   |   |   | | | |         | |             | |     | | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
   +-|-|-----------------|-----------------+ +---|---------|---+       |   |   |   |   +---|-----------|-|-------------|-------+ | | | |       |   |     |     |   +---|-|-|-|-+ | |   | | | | | | | |   
     | |   |   | | | |   |   |               |   |   |     |           |   |   |   |     | | |         | |             | |       | | | |       |   |     |     |     | | | | |   | |   | | | | | | | |   
     | |   |   | | | |   |   |               | +-|-------------------------|-------------|-|-+         | +---------------------------|-------------|-----------|-----|-|-|-|---+ | |   | | | | | | | |   
     | |   |   | | | |   |   |               | | |   |     |           |   |   |   |     | |           |               | |       | | | |       |   |     |     |     | | | | | | | |   | | | | | | | |   
     | |   | +-|-|-------|-----------------------+   |     |   +-+     |   |   |   |     | |           |       +---------|-------|-|-|-|-----------------------|---+ | | | | | | | |   | | | | | | | |   
     | |   | | | | | |   |   |               | |     |     |   | |     |   |   |   |     | |           |       |       | |       | | | |       |   |     |     |   | | | | | | | | |   | | | | | | | |   
 +-+ | |   | | | | | | +-+   |             +-|-------------|---|-|-----|---|---|-----------|---------------------------|---------|-|-|---------|---------|-----+   | | | | | | | | |   | | | | | | | |   
 | | | |   | | | | | | |     |             | | |     |     |   | |     |   |   |   |     | |           |       |       | |       | | | |       |   |     |         | | | | | | | | |   | | | | | | | |   
 | | | | +-----|-------|-------------------|-|-------|---------|-------|-----------|-----|-------------|---------------|-|---+ +---|---|-------|---|-----|---------|-|-----------------|-|---+ | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   |     | |           |       |       | |   | | | | | |       |   |     |         | | | | | | | | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | +-----|-----------|-------|-------------|-|-----|-------------|-----|-----------|-|---|-|-+ | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   | | | | | |       |   |     |         | | | | | |   | |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   | +-------|-------|---------|---------|-|-------------|---|---+   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |   | |   | |     | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |   +-|-------+   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     |         | | | | | |     |   | | |   | | | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |     +---------+ | | | | |     +---|-|-|---|-+ | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |                 | | | | |         | | |   |   | |   
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   +---------------|---|-----------|-|-|-------|-|-+ 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   |             | | | | |         | | |   |   | | | 
 | | | | | | | | | | | |     |       +-----|-|-------------|---|-|-----|-------------------|---------------------------|-|---|---|-|-------------------|-------------|-----|-|---------+ | +-----+ | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |   | |   | |           |       |       | |   |   | | | |       |   |   |             | | | | |           |     | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |   +-|-----|-----------|-------|-------+ |   |   | | | |       |   |   |             | | | | |     +-----|-+   | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |           |       |         |   |   | | | |       |   |   |             | | | | |     |     | |   | | | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |           +-------|-----------------|-|---|---------------|-----------+ | | | | |     | +---|-|-----+ | | | 
 | | | | | | | | | | | |     |       |     | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | | | |     | |   | |   |   | | | 
 | | | | | | | | | | | |     |       +-----|-|-------|-----|-----|-----|---|---|-----|--K--|-------------------|---------|---------|-|-----------------|-----------|-------+ | +-----+   | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | |     |             | | |     |     |   | |     |   |   |     |   | |                   |         |   |   | | | |       |   |   |           | | | |   | |   |     | |   |   | | | 
 | | | | | | | | | | | +-----|---------------|-------|-----|---|-------|---------------------------------------|---------|---+   | | | |       |   |   |       +---+ | | |   | | +-|-----|---+ |   | | | 
 | | | | | | | | | | |       |             | | |     |     |   | |     |   |   |     |   | |                   |         |       | | | |       |   |   |       |     | | |   | | | |     | | | |   | | | 
 | | | | | | | +---|-----------------------|-|-------|-----|---+ |     |   |   |     |   | |                   |         |       | | | |       |   |   | +-------------------|-|---|---+ +-|-|-+   | | | 
 | | | | | | |   | | |       |             | | |     |     |     |     |   |   |     |   | |                   |         |       | | | |       |   |   | |     |     | | |   | | | |   |   | |     | | | 
 | | | | | | | +-|-|-+       |             +---+     |     |   +---------------|---------|---------------------|-----------------|-|-|-----------+ |   | |     |   +-|-|-|-------|---+ |   | |     | | | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |         |       | | | |       | | |   | |     |   | | | |   | | | | | |   | |     | | | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |       +-|---------|-|---------|---------------|---|-|-|-|-------|-|-|-----|-|-----|-+ | 
 | | | | | | | | | |         |               |       |     |   | |     |   |   |     |   | |                   |       | |       | | | |       | | |   | |     |   | | | |   | | | | | |   | |     |   | 
 | | | | | | | | | |         |               |       |     |   | |   +---------|-----|---|-+                   |       | |       | | | |       | | |   | |     |   | | | | +---|-----------|-------|-+ | 
 | | | | | | | | | |         |               |       |     |   | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     |   | | | | | | | | | | |   | |     | | | 
 | | | | | | | | | |         |               | +-----|-----------------|---|-------------|---------------------|-----------------|-|-|-|---------|-|-----|-----|-+ +-----|---+ | | | | |   | |     | | | 
 | | | | | | | | | |         |               | |     |     |   | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     | |   | | | |   | | | | |   | |     | | | 
 | | | | | | | +---+         |               +-|-----+     +---|-|-----|---|---|-----|-------------------------------------------|---------------|-|-----|-----|-----|-|-|---+ | | | | |   | |     | | | 
 | | | | | | |   |           |                 |               | |   | |   |   |     |   |                     |       | |       | | | |       | | |   | |     | |   | | | | | | | | | |   | |     | | | 
 | | | | | | |   | +---------|-----------------+               | |   | |   |   |     |   |     +---------------|-----------------|---|-|-------|-|-|---|-|---------+ | | | | | | | | | |   | |     | | | 
 | | | | | | |   | |         |                                 | |   | |   |   |     |   |     |               |       | |       | | | |       | | |   | |     | | | | | | | | | | | | |   | |     | | | 
 | | | | | | |   | | +-------|---------------------------------------------|---------|---|-----|-----------------------|---------+ | | |       | | |   | |     | | | | +-----|-|-+ | | |   | |     | | | 
 | | | | | | |   | | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     | | | |   | | | |   | | |   | |     | | | 
 | | | | | | | +-+ | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     | +---|-----|---|---|-------------+ | | | 
 | | | | | | | |   | |       |                                 | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | |   | | | |   | | |   | |   | | | | 
 | | | | | | | | +-----------|-------------------------------+ | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | | +-|-+ | | +-----|---------|-+ | | 
 | | | | | | | | | | |       |                               | | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |     |   | | | |   | | | | | |   | |   |   | | 
 | | | | | | | | | +---------|-------------------------------------------------------|---|-----|-----------------------------------|-|-----------------|-----+ |   | | +-----|-+ | | | |   | |   |   | | 
 | | | | | | | | |   |       |                               | | |   | |   |   |     |   |     |               |       | |         | | |       | | |   | |   | |   | |   |   |   | | | |   | |   |   | | 
 | | | | | +---|-|-------------------+               +-----------------|-------------|---|-+   |               |       +-|---------|---|---------------|-|-----|---|-|-+ | L | +-|---|-|---|-|---|---+ | 
 | | | | |   | | |   |       |       |               |       | | |   | |   |   |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     | 
 | | | | |   | | |   |       |       |               |       | | |   | | +-+   |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     | 
 | | | | |   | | |   |       |       |               |       | | |   | | |     |     |   | |   |               |         |         | | |       | | |   | |   | |   | | | | | | | | | | |   | |   |     O 
 | | | | |   | | |   |       |       |               |       +---+   | | +-----------|---------+               |         |         | | |       | | |   +-|-+ | |   | | | | | | | +---|-+   | |   |     | 
 | | | | |   | | |   |       |       |               |         |     | |       |     |   | |                   |         |         | | |       | | |     | | | |   | | | | | | |   | |     | |   |     | 
 | | | | | +-----+ +-|-------|-------|-------------------------------|---------|-----|-----|-------+           |         |         | | |       | | |     +-----|-------------|-|---|-----+ | |   | +---+ 
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | | | |   | |       |       |               |         |     | |       |     |   | |       |           |         |         | | |       | | |       | | |   | | | | | | |   | |   | | |   | |     
 | | | | | +---|----N------+ |       |               |         |     | |       |     |   | |       |           |         +-----------------------------+   | | |   | +-|-----|-|---|-+   | | |   | |     
 | | | | |   | |   | |     | |       |               |         |     | |       |     |   | |       |           |                   | | |       | | |   |   | | M   |   | | | | |   |     | | |   | |     
 | | | | |   | |   | |     | |       |               | +---------------|-------------------|-------|---------------------------------------------|-+   |   | | |   |   | | | | |   |     | | |   | |     
 | | | | |   | |   | |     | |       |               | |       |     | |       |     |   | |       |           |                   | | |       | |     |   | | |   |   | | | | |   |     | | |   | |     
 | | | | |   | +---|-|-------|-----------------------|-|-------|-------------------------|---------------------|-------------------|-|-|-+     | |     |   | | |   |   | | +-|-+   |     | | |   | |     
 | | | | |   |     | |     | |       |               | |       |     | |       |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   |     | |     | |       |               | +-------|-------|-+     |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   |     | |     | |       |               |         |     | | |     |     |   | |       |           |                   | | | |     | |     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   | +---|-|-----|-|-------|---------+     |       +---+   +---------|-----------|-------|-----------|-------------------------|-------+     |   | | |   |   | |   |     |     | | |   | |     
 | | | | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | | | |     |       |   | | |   |   | |   |     |     | | |   | |     
 | | +-------------|---------|-----------------------|---------|-|-------------|-----|---|---------|-----------|-------------------|-|-+ |     |       |   | | |   |   | |   |     |     | | |   | | +-+ 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     |   | |       |           |                   | |   |     |       |   | | |   |   | |   |     |     | | |   | | | | 
 | |   | |   | |   | |     +-------------------|-----|-----------|-----|-|-----|-----------|---------------------------------------|-+   |     |       |   | +-|---|-----|-+ |     +-------|---+ | | | | 
 | |   | |   | |   | |       |       |         |     |       | | |     | |     |     |   | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     +-|-------|---------------------------|-----|---------------+ | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     | |       |         |     |       | | |     | |     |     | | | |       |           |                   |     |     |       |   |   |   |   | | | |           | | | | | | | | 
 | |   | |   | |   | |     | |       +-----------------------------------|-----------|---------------------------------------------|-----|-------------|-----------------|-|---+         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |       | | |     | |     |     | | | |       |           |                   |     |     |       |   |   |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |     +-|-|---------|---------------|-|---------------------------------------|-----------|-------|---|-+ |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |     |     | | | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |   +-|-----|-+ | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | |   | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         | | | | | | | | 
 | |   | |   | +---|-|-----------------------------|-|---------|-------|-|-------------|-|-|-------------------|-------------------------|-----|-------|---|-|---------|-|-|-|-|---------|-+ | | | | | | 
 | |   | |   |     | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |     |       |   | | |   |   | | | | |         |   | | | | | | 
 | |   +-----|-------|-----|-------------------|-----|-----|-----------|-|-----|-------|-|-----------------------------------------|---------+ |       |   | | |   | +---|-|-----------+ |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     |   | |     | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     | +-------+ | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | |     |   |     | |     | |                 |   | |     | | | |   | | |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | |   | | | | | | 
 | | +-------|-+   | |     | |                 |   | |     +-|---|---|-+ |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | | +---+ | | | | 
 | | |   |   | |   | |     | |                 |   | |       | | |   |   |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | | |       | | | |   | | | | 
 | | |   |   | |   | |     | |                 |   | | +-------|---------------------|-|-------------------------------------------|-----|---|-|-----------|-|-|-----|-|-|-|---+       | | | |   | | | | 
 | | |   |   | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |                   |     |   | |       |   | | |   | | | | | |         | | | |   | | | | 
 | | | +-----|-|-----|------------------------------X--|-----|-|-|-------------|-----|---|---------------------|-------+           |     |   | +-------|-----------|-|-----|---------+ | | | |   | | | | 
 | | | | |   | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |           |     |   |         |   | | |   | | | | | |       | | | | |   | | | | 
 | | | | +-+ | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |       +---------|---|---------|---|-------|-|-----------------|-|--H|-------+ | 
 | | | |   | | |   | |     | |                 |   | | |     | | |   |   |     |     | | | |       |           |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   | | |   | |   +---|---------------------|-|-------|---|-------|---------------|---------|-+         |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   | | |   | |   | | |                 |   | | |     | | |   |   |     |     | | | |       | |         |       |       |   |     |   |         |   | | |   | | | | | |       | | | | |   | |   | 
 | | | |   +---|---------|-+ |                 | +-----|-----|-------|---------|-----|-|-|---------------------+       |       |   |     |   |         |   | +-------------|-----------+ | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | | |     | | |   |   |     |     | | | |       | |                 |       |   |     |   |         |   |   |   | | | | | |       |   | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | | +-----+ | |   |   |     |     | | | |     +-|-+                 |       |   |     |   |         |   |   |   | +-|-|---------+ |   | | |   | |   | 
 | | | |     | |   | |   |   |                 | | | |         | |   |   |     |     | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | +---|---+ | | +-|---|-------------------|-|-|---------|-----|---|---------+ | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | |   | | | | | | |   |                 | | | |         | |   |   |     |   | | | | |     | |                   |       |   |     |   |         |   |   |   |   | | | |     | |   | | |   | |   | 
 | | | | +-----+ | | | +-----------------------------------------|-------|-----|-----|-|-|-|-----+ |                   +-----------|---------|-----------------|---|---|---|---+   +-|---------+ | |   | 
 | | | |     |   | | |   |   |                 | | | |         | |   |   |     |   | | | | |       |                           |   |     |   |         |   |   |   |   | | | | |     |   | | | | | |   | 
 | +---|---------|-|-------------------------------|-|---------|-----|---|-------------|---|-------|-------------------------------------|-------------|---|-+ |   |   | | | | |     |   | | | | | |   | 
 |   | |     |   | | |   |   |                 | | | |         | |   |   |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | +-|---+ +-|---|-+ |   +---|-------------------|-|-----------|-|-----+ |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | | | | | | |   |   |       |                 | | | |         | |   | | |     |   | | | | |       |                           |   |     |   |         |   | | |   |   | | | | |     |   | | | | | |   | 
 | | | | | | |   +---|-------------------------|-|-------------|-----|---------+   | | | | +-------|---------------------------|---|-----|---|---------|---|-|-----|---|-----|-------|---|-----+ | |   | 
 | | | | | | |       |       |                 | | | |         | |   | | |         | | | |         |                           |   |     |   |         |   | | |   |   | | | | |     |   | | |   | |   | 
 | | | +-------------|-------+                 | | +-|---------|-|---|-|-----------|-|-----------------+                       |   |     |   |         |   | | |   |   +---|-|-------|---|-|-|-+ | |   | 
 | | |   | | |       |                         | |   |         | |   | | |         | | | |         |   |                       |   |     |   |         |   | | |   |     | | | |     |   | | | | | |   | 
 | | |   | | |       |                         | |   +---------|-|-----|-|---------|---|-|-+       |   |                       |   |     |   |         |   | | | +-------|---|-------|-------|-|-|-|-+ | 
 | | |   | | |       |                         | |             | |   | | |         | | | | |       |   |                       |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |   +-|-----------------------------------|---------------------|-|-|---------|---|-|---------|---+                       |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |     | |       |                         | |             | |   | | |         | | | | |       |                           |   |     |   |         |   | | | | |     | | | |     |   | | | | | | | | 
 | | |     | |       |                         | |             | |   | +-------------|---|-------------------------------------|---------|---|---------|-+ | | | | |     | | | |     |   | | | +-|-|-|-+ 
 | | |     | |       |                         | |             | |   |   |         | | | | |       |                           |   |     |   |         | | | | | | |     | | | |     |   | | |   | | |   
 | | |     | |       +-----------------------------------------|-|-------------------|-------------|---------------------------|-----+   |   |         | +-|---|-|-----+ | | | +-----|---|-|---+ | | |   
 | | |     | |                                 | |             | |   |   |         | | | | |       |                           |   | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
 +-|-------|-----------------------------------|---------------------|-------------|-|-|---|-------+         +-----------------+   | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
   | |     | |                                 | |             | |   |   |         | | | | |                 |                     | |   |   |         |   | | | | |   | | | |       |   | | | | | | |   
   | |     +-|-----------------------------------|---------------|-----------------|---|---|-----------------|---------------------|-------------------+   | | | | |   | | | |       |   | | | | | | |   
   | |       |                                 | |             | |   |   |         | Z | | |                 |                     | |   |   |             | | | | |   | | | |       |   | | | | | | |   
 +-|-|-------+       +-------------------------|-----------------+   +---+         | | | | |                 |                     | +-----------------------|-+ | |   | | | |       |   | | | | | | |   
 | | |               |                         | |             |                   | | | | |                 |                     |     |   |             | |   | |   | | | |       |   | | | | | | |   
 +-----------+       +-+                       +-|-------+     +-------------------+ | +---+   +-----------------------------------------------------------|-|---|-|---|-|-|-|-+     |   | | | | | | |   
   | |       |         |                         |       |                           |   |     |             |                     |     |   |             | |   | |   | | | | |     |   | | | | | | |   
   +---------|---------|-------------------------+       +-------------+             |   |     +-------------|---------------------+     +---------------+ | |   | +---|-----|-----+ |   | +-|-|-+ | |   
     |       |         |                                               |             |   |                   |                               |           | | |   |     | | | | |   | |   |   | |   | |   
     |       +---------|-----------------------------------------------|---------------------------------------------------------------------------------|-|-----|-----|-|-+ | |   | |   |   | |   | |   
     |                 |                                               |             |   |                   |                               |           | | |   |     | |   | |   | |   |   | |   | |   
     +-----------------+ +-------------------------------------------------------------------------------------------------------------------+           | | +---|-----|-----|-----|-+   |   | |   | |   
                         |                                             |             |   |                   |                                           | |     |     | |   | |   |     |   | |   | |   
                         |                                             |             |   |                   |                                           | +-----|-----|-|-----|---|---------+ |   | |   
                         |                                             |             |   |                   |                                           |       |     | |   | |   |     |     |   | |   
                         +---------------------------------------------------------------|-------------------|-------------------------------------------|-------|-------|---------------+     |   | |   
                                                                       |             |   |                   |                                           |       |     | |   | |   |           |   | |   
 +---------------------------------------------------------------------|-------------|-----------------------+                                           |       +-------+   | |   |           +---|-+   
 |                                                                     |             |   |                                                               |             |     | |   |               |     
 |                                                                     +-------------+   |                                                               +-------------|-----+ |   +-----------+   |     
 |                                                                                       |                                                                             |       |               |   |     
 +---------------------------------------------------------------------------------------+                                                                             +-------+               +---+     
                                                                                                                                                                                                          `;
var grid = processInput(str);
setup(ctx, grid);
demo(ctx, str);
